import os
import sys
import json
import base64
import argparse

from IPython.utils.tempdir import TemporaryDirectory
from jupyter_client.kernelspec import KernelSpecManager

kernel_logo = b'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'
kernel_json = {"argv":[sys.executable, "-m", "hbase_kernel", "-f", "{connection_file}"],
               "display_name":"Hbase",
               "language":"sql"}

def install_my_kernel_spec(user=True, prefix=None):
    with TemporaryDirectory() as td:
        os.chmod(td, 0o755)
        with open(os.path.join(td, 'kernel.json'), 'w') as f:
            json.dump(kernel_json, f, sort_keys=True)
        with open(os.path.join(td, 'logo-64x64.png'), 'wb') as f:
            f.write(base64.b64decode(kernel_logo))
        print('Installing Jupyter Hbase kernel spec.')
        KernelSpecManager().install_kernel_spec(td, 'Hbase', user=user, replace=True, prefix=prefix)

def _is_root():
    try:
        return os.geteuid()==0
    except AttributeError:
        return False

def main(argv=None):
    parser = argparse.ArgumentParser(description='Install Jupyter KernelSpec for Hbase Kernel.')
    prefix_locations = parser.add_mutually_exclusive_group()
    prefix_locations.add_argument('--user',
                                  help='Install Jupyter Hbase KernelSpec in user homedirectory.',
                                  action='store_true')
    prefix_locations.add_argument('--sys-prefix',
                                  help='Install Jupyter Hbase KernelSpec in sys.prefix. Useful in conda / virtualenv',
                                  action='store_true',
                                  dest='sys_prefix')
    prefix_locations.add_argument('--prefix',
                                  help='Install Jupyter Hbase KernelSpec in this prefix',
                                  default=None)
    args = parser.parse_args(argv)

    user = False
    prefix = None
    if args.sys_prefix:
        prefix = sys.prefix
    elif args.prefix:
        prefix = args.prefix
    elif args.user or not _is_root():
        user = True

    install_my_kernel_spec(user=user, prefix=prefix)

if __name__ == '__main__':
    main()